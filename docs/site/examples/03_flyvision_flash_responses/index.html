
<!doctype html>
<html lang="en" class="no-js">
  <head>

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">



        <link rel="canonical" href="https://flyvis.github.io/examples/03_flyvision_flash_responses/">


        <link rel="prev" href="../02_flyvision_optic_flow_task/">


        <link rel="next" href="../04_flyvision_moving_edge_responses/">


      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">



        <title>Flash responses - flyvis docs</title>



      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">


        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">












        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>



      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">

      <link rel="stylesheet" href="../../style.css">

    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>






  </head>









    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">


    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">


        <a href="#flash-responses" class="md-skip">
          Skip to content
        </a>

    </div>
    <div data-md-component="announce">

    </div>







<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="flyvis docs" class="md-header__button md-logo" aria-label="flyvis docs" data-md-component="logo">

  <img src="../../images/flyvis_logo_light@150 ppi.webp" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">

      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            flyvis docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">

              Flash responses

          </span>
        </div>
      </div>
    </div>


        <form class="md-header__option" data-md-component="palette">




    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">

      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>





    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">

      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>





    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">

      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>


</form>



      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>



      <label class="md-header__button md-icon" for="__search">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">

        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>

    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>


  </nav>

</header>


    <div class="md-container" data-md-component="container">






      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">



              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="flyvis docs" class="md-nav__button md-logo" aria-label="flyvis docs" data-md-component="logo">

  <img src="../../images/flyvis_logo_light@150 ppi.webp" alt="logo">

    </a>
    flyvis docs
  </label>

  <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">


  <span class="md-ellipsis">
    Home
  </span>


      </a>
    </li>









    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">


  <span class="md-ellipsis">
    Installation
  </span>


      </a>
    </li>















    <li class="md-nav__item md-nav__item--active md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>


          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">


  <span class="md-ellipsis">
    Tutorials
  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../01_flyvision_connectome/" class="md-nav__link">


  <span class="md-ellipsis">
    Explore the connectome
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../02_flyvision_optic_flow_task/" class="md-nav__link">


  <span class="md-ellipsis">
    Train the network
  </span>


      </a>
    </li>












    <li class="md-nav__item md-nav__item--active">

      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">





        <label class="md-nav__link md-nav__link--active" for="__toc">


  <span class="md-ellipsis">
    Flash responses
  </span>


          <span class="md-nav__icon md-icon"></span>
        </label>

      <a href="./" class="md-nav__link md-nav__link--active">


  <span class="md-ellipsis">
    Flash responses
  </span>


      </a>



<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#you-can-skip-the-next-cells-if-you-are-not-on-google-colab-but-run-this-locally" class="md-nav__link">
    <span class="md-ellipsis">
      You can skip the next cells if you are not on google colab but run this locally
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#flash-stimuli" class="md-nav__link">
    <span class="md-ellipsis">
      Flash stimuli
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#network-flash-response" class="md-nav__link">
    <span class="md-ellipsis">
      Network flash response
    </span>
  </a>

    <nav class="md-nav" aria-label="Network flash response">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#flash-response-index-fri" class="md-nav__link">
    <span class="md-ellipsis">
      Flash response index (FRI)
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#fri-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      FRI correlation
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#ensemble-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Ensemble responses
    </span>
  </a>

    <nav class="md-nav" aria-label="Ensemble responses">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#response-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Response traces
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#flash-response-index-fri_1" class="md-nav__link">
    <span class="md-ellipsis">
      Flash response index (FRI)
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#fri-correlation_1" class="md-nav__link">
    <span class="md-ellipsis">
      FRI correlation
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>

    </li>










    <li class="md-nav__item">
      <a href="../04_flyvision_moving_edge_responses/" class="md-nav__link">


  <span class="md-ellipsis">
    Moving edge responses
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../05_flyvision_umap_and_clustering_models/" class="md-nav__link">


  <span class="md-ellipsis">
    Ensemble clustering
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../06_flyvision_maximally_excitatory_stimuli/" class="md-nav__link">


  <span class="md-ellipsis">
    Maximally excitatory stimuli
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../07_flyvision_providing_custom_stimuli/" class="md-nav__link">


  <span class="md-ellipsis">
    Custom stimuli
  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>













    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >


          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">


  <span class="md-ellipsis">
    Main results
  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Main results
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../figure_01_fly_visual_system/" class="md-nav__link">


  <span class="md-ellipsis">
    Figure 1
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../figure_02_simple_stimuli_responses/" class="md-nav__link">


  <span class="md-ellipsis">
    Figure 2
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../figure_03_naturalistic_stimuli_responses/" class="md-nav__link">


  <span class="md-ellipsis">
    Figure 3
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../figure_04_mechanisms/" class="md-nav__link">


  <span class="md-ellipsis">
    Figure 4
  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>













    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >


          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">


  <span class="md-ellipsis">
    API Reference
  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../../reference/connectome/" class="md-nav__link">


  <span class="md-ellipsis">
    Connectome
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/network/" class="md-nav__link">


  <span class="md-ellipsis">
    Network
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/sintel/" class="md-nav__link">


  <span class="md-ellipsis">
    Sintel
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/tasks/" class="md-nav__link">


  <span class="md-ellipsis">
    Task
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/solver/" class="md-nav__link">


  <span class="md-ellipsis">
    Training
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/flash_responses/" class="md-nav__link">


  <span class="md-ellipsis">
    Flash Responses
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/moving_stimulus_responses/" class="md-nav__link">


  <span class="md-ellipsis">
    Moving Stimulus Responses
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/ensemble_clustering/" class="md-nav__link">


  <span class="md-ellipsis">
    Ensemble Clustering
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/optimal_stimuli/" class="md-nav__link">


  <span class="md-ellipsis">
    Optimal Stimuli
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/scripts/" class="md-nav__link">


  <span class="md-ellipsis">
    Scripts
  </span>


      </a>
    </li>














    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_11" >


          <label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex="0">


  <span class="md-ellipsis">
    Miscelleanous
  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_11">
            <span class="md-nav__icon md-icon"></span>
            Miscelleanous
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../../reference/rendering/" class="md-nav__link">


  <span class="md-ellipsis">
    Rendering
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/augmentation/" class="md-nav__link">


  <span class="md-ellipsis">
    Augmentation
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/datasets/" class="md-nav__link">


  <span class="md-ellipsis">
    Datasets
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/utils/" class="md-nav__link">


  <span class="md-ellipsis">
    Utils
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/visualizations/" class="md-nav__link">


  <span class="md-ellipsis">
    Visualizations
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/animations/" class="md-nav__link">


  <span class="md-ellipsis">
    Animations
  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>




          </ul>
        </nav>

    </li>









    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">


  <span class="md-ellipsis">
    Contributing
  </span>


      </a>
    </li>









    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">


  <span class="md-ellipsis">
    FAQ
  </span>


      </a>
    </li>









    <li class="md-nav__item">
      <a href="../../acknowledgements/" class="md-nav__link">


  <span class="md-ellipsis">
    Acknowledgements
  </span>


      </a>
    </li>



  </ul>
</nav>
                  </div>
                </div>
              </div>



              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#you-can-skip-the-next-cells-if-you-are-not-on-google-colab-but-run-this-locally" class="md-nav__link">
    <span class="md-ellipsis">
      You can skip the next cells if you are not on google colab but run this locally
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#flash-stimuli" class="md-nav__link">
    <span class="md-ellipsis">
      Flash stimuli
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#network-flash-response" class="md-nav__link">
    <span class="md-ellipsis">
      Network flash response
    </span>
  </a>

    <nav class="md-nav" aria-label="Network flash response">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#flash-response-index-fri" class="md-nav__link">
    <span class="md-ellipsis">
      Flash response index (FRI)
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#fri-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      FRI correlation
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#ensemble-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Ensemble responses
    </span>
  </a>

    <nav class="md-nav" aria-label="Ensemble responses">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#response-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Response traces
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#flash-response-index-fri_1" class="md-nav__link">
    <span class="md-ellipsis">
      Flash response index (FRI)
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#fri-correlation_1" class="md-nav__link">
    <span class="md-ellipsis">
      FRI correlation
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>
                  </div>
                </div>
              </div>



            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">




<h1 id="flash-responses">Flash responses</h1>
<p>This notebook introduces flash responses and the flash response index (FRI). </p>
<p>The FRI measures whether a cell depolarizes to bright or to dark increments in a visual input.</p>
<h5 id="you-can-skip-the-next-cells-if-you-are-not-on-google-colab-but-run-this-locally">You can skip the next cells if you are not on google colab but run this locally</h5>
<p><strong>Select GPU runtime</strong></p>
<p>Only for usage on google colab: to run the notebook on a GPU select Menu -&gt; Runtime -&gt; Change runtime type -&gt; GPU.</p>
<pre><code>%load_ext autoreload
%autoreload 2
</code></pre>
<pre><code># @markdown **Check access to GPU**

try:
    import google.colab

    IN_COLAB = True
except ImportError:
    IN_COLAB = False

if IN_COLAB:
    import torch

    try:
        cuda_name = torch.cuda.get_device_name()
        print(f&quot;Name of the assigned GPU / CUDA device: {cuda_name}&quot;)
    except RuntimeError:
        import warnings

        warnings.warn(
            &quot;You have not selected Runtime Type: 'GPU' or Google could not assign you one. Please revisit the settings as described above or proceed on CPU (slow).&quot;
        )
</code></pre>
<p><strong>Install Flyvis</strong></p>
<p>The notebook requires installing our package <code>flyvis</code>. You may need to restart your session after running the code block below with Menu -&gt; Runtime -&gt; Restart session. Then, imports from <code>flyvis</code> should succeed without issue.</p>
<pre><code>if IN_COLAB:
    # @markdown **Install Flyvis**
    %%capture
    !git clone https://github.com/flyvis/flyvis-dev.git
    %cd /content/flyvis-dev
    !pip install -e .
</code></pre>
<pre><code># basic imports
import matplotlib.pyplot as plt
import numpy as np
import logging

logging.disable(100)

plt.rcParams['figure.dpi'] = 200
</code></pre>
<h2 id="flash-stimuli">Flash stimuli</h2>
<p>To elicit flash responses, experimenters show a flashing dot to the subject in the center of their field of view. We generate and render these stimuli with the <code>Flashes</code> dataset.</p>
<pre><code># import dataset and visualization helper
from flyvision.analysis.animations.hexscatter import HexScatter
from flyvision.datasets.flashes import Flashes
</code></pre>
<pre><code># initialize dataset
dataset = Flashes(
    dynamic_range=[0, 1],  # min and max pixel intensity values, must be in range [0, 1]
    t_stim=1.0,  # duration of flash
    t_pre=1.0,  # duration of period between flashes
    dt=1 / 200,  # temporal resolution of rendered video
    radius=[-1, 6],  # radius of flashing dot. -1 fills entire field of view
    alternations=(0, 1, 0),  # flashing pattern, off - on - off
)
</code></pre>
<pre><code># view stimulus parameters
dataset.arg_df
# the dataset has four samples, one corresponding to each row
</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>baseline</th>
      <th>intensity</th>
      <th>radius</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.5</td>
      <td>0</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.5</td>
      <td>0</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.5</td>
      <td>1</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.5</td>
      <td>1</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code># visualize single sample
animation = HexScatter(
    dataset[3][None, ::50, None], vmin=0, vmax=1
)  # intensity=1, radius=6
animation.animate_in_notebook()
</code></pre>
<p><img alt="png" src="../03_flyvision_flash_responses_files/03_flyvision_flash_responses_12_0.png" /></p>
<h2 id="network-flash-response">Network flash response</h2>
<p>Now that we have generated the stimulus, we can use it to drive a trained connectome-constrained network.</p>
<pre><code>from flyvision import results_dir
from flyvision.network import NetworkView

# model are already sorted by task error
# we take the best task-performing model from the pre-sorted ensemble
network_view = NetworkView(results_dir / &quot;flow/0000/000&quot;)
</code></pre>
<pre><code>stims_and_resps = network_view.flash_responses(dataset=dataset)
</code></pre>
<pre><code>stims_and_resps['responses'].custom.where(cell_type=&quot;L1&quot;, radius=6).custom.plot_traces(
    x='time'
)
fig = plt.gcf()
fig.axes[-1].set_title(&quot;L1 flash responses&quot;)
</code></pre>
<pre><code>Text(0.5, 1.0, 'L1 flash responses')
</code></pre>
<p><img alt="png" src="../03_flyvision_flash_responses_files/03_flyvision_flash_responses_16_1.png" /></p>
<h3 id="flash-response-index-fri">Flash response index (FRI)</h3>
<p>The flash response index (FRI) is a measure of the strength of contrast tuning of a particular cell. It is computed as the difference between the cell's peak voltage in response to on-flashes (intensity = 1) and off-flashes (intensity = 0), divided by the sum of those peak values.</p>
<p>That is, given a single neuron's response to on-flashes <code>r_on</code> and off-flashes <code>r_off</code> (both of <code>shape=(T,)</code>), we can compute the flash response index with</p>
<pre><code>r_on_max = max(r_on)
r_off_max = max(r_off)
fri = (r_on_max - r_off_max) / (r_on_max + r_off_max + 1e-16)
</code></pre>
<p>with the additional <code>1e-16</code> simply for numerical stability. Before this calculation, the response traces are shifted to be non-negative.</p>
<p>The flash response index can take on values between $-1$, when the off response is much stronger (or more positive) than the on response, to $1$, when the on response is much stronger (or more positive) than the off response.</p>
<p>For the L1 cell plotted before, we can see that it displays a positive response to off flashes and a negative response to on flashes, so we expect a negative flash response index.</p>
<pre><code>from flyvision.analysis.flash_responses import flash_response_index
</code></pre>
<pre><code>fris = flash_response_index(stims_and_resps, radius=6)
</code></pre>
<pre><code>fris.custom.where(cell_type=&quot;L1&quot;)
</code></pre>
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body[data-theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-index-preview {
  grid-column: 2 / 5;
  color: var(--xr-font-color2);
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data,
.xr-index-data-in:checked ~ .xr-index-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-index-name div,
.xr-index-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data,
.xr-index-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2,
.xr-no-icon {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;responses&#x27; (network_id: 1, sample: 1, neuron: 1)&gt;
array([[[-0.33354017]]], dtype=float32)
Coordinates:
    baseline     (sample) float64 0.5
    radius       (sample) int32 6
  * neuron       (neuron) int64 8
    cell_type    (neuron) &lt;U8 &#x27;L1&#x27;
    u            (neuron) int32 0
    v            (neuron) int32 0
    checkpoints  (network_id) object /groups/turaga/home/lappalainenj/FlyVis/...
Dimensions without coordinates: network_id, sample</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'responses'</div><ul class='xr-dim-list'><li><span>network_id</span>: 1</li><li><span>sample</span>: 1</li><li><span class='xr-has-index'>neuron</span>: 1</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-2063a976-47bc-4b36-a1bd-ecd94498b9a0' class='xr-array-in' type='checkbox' checked><label for='section-2063a976-47bc-4b36-a1bd-ecd94498b9a0' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>-0.3335</span></div><div class='xr-array-data'><pre>array([[[-0.33354017]]], dtype=float32)</pre></div></div></li><li class='xr-section-item'><input id='section-26e7ff6c-915c-40c5-b4bd-ffe361bd70cf' class='xr-section-summary-in' type='checkbox'  checked><label for='section-26e7ff6c-915c-40c5-b4bd-ffe361bd70cf' class='xr-section-summary' >Coordinates: <span>(7)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>baseline</span></div><div class='xr-var-dims'>(sample)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.5</div><input id='attrs-41768298-8080-4658-acc8-40aed8eb08bf' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-41768298-8080-4658-acc8-40aed8eb08bf' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0ef01749-bbe2-46ac-8035-1a692f136eb6' class='xr-var-data-in' type='checkbox'><label for='data-0ef01749-bbe2-46ac-8035-1a692f136eb6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0.5])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>radius</span></div><div class='xr-var-dims'>(sample)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>6</div><input id='attrs-1cfecd03-0349-4aff-ad8e-62b6d27338a9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-1cfecd03-0349-4aff-ad8e-62b6d27338a9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fae6f75b-6d1f-44bc-84b5-6e74c75d9c7d' class='xr-var-data-in' type='checkbox'><label for='data-fae6f75b-6d1f-44bc-84b5-6e74c75d9c7d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([6], dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>neuron</span></div><div class='xr-var-dims'>(neuron)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>8</div><input id='attrs-8397e149-482a-431b-ba81-5ed6a070d177' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8397e149-482a-431b-ba81-5ed6a070d177' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b50656ac-67aa-46f2-8aa1-e5f09cdff185' class='xr-var-data-in' type='checkbox'><label for='data-b50656ac-67aa-46f2-8aa1-e5f09cdff185' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([8])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>cell_type</span></div><div class='xr-var-dims'>(neuron)</div><div class='xr-var-dtype'>&lt;U8</div><div class='xr-var-preview xr-preview'>&#x27;L1&#x27;</div><input id='attrs-4771db33-ccb8-45c4-9c33-2842dc5b401e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4771db33-ccb8-45c4-9c33-2842dc5b401e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f379191f-ed5c-46e4-a8b1-8c433c0c4f27' class='xr-var-data-in' type='checkbox'><label for='data-f379191f-ed5c-46e4-a8b1-8c433c0c4f27' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;L1&#x27;], dtype=&#x27;&lt;U8&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>u</span></div><div class='xr-var-dims'>(neuron)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-bc6a0fcc-81c5-4af6-8458-a0e57fc5158b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-bc6a0fcc-81c5-4af6-8458-a0e57fc5158b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-021d9297-d323-452e-bf9e-c60877685091' class='xr-var-data-in' type='checkbox'><label for='data-021d9297-d323-452e-bf9e-c60877685091' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0], dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>v</span></div><div class='xr-var-dims'>(neuron)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-6b1539ab-c923-4c5b-89c6-5d9e69a742d9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6b1539ab-c923-4c5b-89c6-5d9e69a742d9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2ff123e4-62a5-44f5-8f2d-356ee140c602' class='xr-var-data-in' type='checkbox'><label for='data-2ff123e4-62a5-44f5-8f2d-356ee140c602' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([0], dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>checkpoints</span></div><div class='xr-var-dims'>(network_id)</div><div class='xr-var-dtype'>object</div><div class='xr-var-preview xr-preview'>/groups/turaga/home/lappalainenj...</div><input id='attrs-6ddaa6e6-4be7-40a3-8876-362ca972442e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6ddaa6e6-4be7-40a3-8876-362ca972442e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-cc3e3e9d-c45a-41a6-a9a3-239f494f7733' class='xr-var-data-in' type='checkbox'><label for='data-cc3e3e9d-c45a-41a6-a9a3-239f494f7733' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([PosixPath(&#x27;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000/chkpts/chkpt_00000&#x27;)],
      dtype=object)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-4ecf6afb-b4c7-487f-8210-d55239ab21dd' class='xr-section-summary-in' type='checkbox'  ><label for='section-4ecf6afb-b4c7-487f-8210-d55239ab21dd' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>neuron</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-b7ea5a2f-5307-4986-9fda-16defaafbe40' class='xr-index-data-in' type='checkbox'/><label for='index-b7ea5a2f-5307-4986-9fda-16defaafbe40' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([8], dtype=&#x27;int64&#x27;, name=&#x27;neuron&#x27;))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c690130b-b185-4da6-b60d-3521f89bbd39' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-c690130b-b185-4da6-b60d-3521f89bbd39' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>

<h3 id="fri-correlation">FRI correlation</h3>
<p>Since the tuning of some cell types have been determined experimentally, we can then compare our model to experimental findings by computing the correlation between the model FRIs for known cell types with their expected tuning.</p>
<pre><code>from flyvision.analysis.flash_responses import fri_correlation_to_known
from flyvision.utils.groundtruth_utils import polarity
</code></pre>
<pre><code>fri_corr = fri_correlation_to_known(fris)
</code></pre>
<pre><code># manually extract model and true FRIs for plotting
known_cell_types = [k for k, v in polarity.items() if v != 0]
model_fris = [fris.custom.where(cell_type=k).item() for k in known_cell_types]
true_fris = [polarity[k] for k in known_cell_types]
# plot
plt.figure(figsize=[2, 1])
plt.scatter(model_fris, true_fris, color=&quot;k&quot;, s=10)
plt.xlabel(&quot;predicted FRI&quot;)
plt.ylabel(&quot;putative FRI (true tuning)&quot;)
plt.axvline(0, linestyle=&quot;--&quot;, color=&quot;black&quot;)
plt.axhline(0, linestyle=&quot;--&quot;, color=&quot;black&quot;)

plt.axhspan(0, 2, 0, 0.5, color=&quot;red&quot;, zorder=-10)
plt.axhspan(0, 2, 0.5, 1.0, color=&quot;green&quot;, zorder=-10)
plt.axhspan(-2, 0, 0, 0.5, color=&quot;green&quot;, zorder=-10)
plt.axhspan(-2, 0, 0.5, 1.0, color=&quot;red&quot;, zorder=-10)

plt.xlim(-1.05, 1.05)
plt.ylim(-2, 2)
plt.title(f&quot;Correlation = {fri_corr[0].item():.2g}&quot;)
plt.yticks([-1, 1], [&quot;OFF&quot;, &quot;ON&quot;])
plt.show()
</code></pre>
<p><img alt="png" src="../03_flyvision_flash_responses_files/03_flyvision_flash_responses_25_0.png" /></p>
<p>As we can see, for all except two cell types, the model correctly predicts the cell's tuning (positive or negative).</p>
<h2 id="ensemble-responses">Ensemble responses</h2>
<p>Now we can compare tuning properties across an ensemble of trained models. First we need to again simulate the network responses.</p>
<pre><code>from flyvision import EnsembleView

ensemble = EnsembleView(&quot;flow/0000&quot;)
</code></pre>
<pre><code>Loading ensemble:   0%|          | 0/50 [00:00&lt;?, ?it/s]
</code></pre>
<pre><code>stims_and_resps = ensemble.flash_responses(dataset=dataset)
</code></pre>
<pre><code>Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]
</code></pre>
<h3 id="response-traces">Response traces</h3>
<p>We can once again plot response traces for a single cell type. We subtract the initial value of each trace to center the data before plotting, as the network neuron activities are in arbitrary units.</p>
<pre><code>centered = (
    stims_and_resps['responses']
    - stims_and_resps['responses'].custom.where(time=0.0).values
)
</code></pre>
<pre><code>centered.sel(network_id=ensemble.argsort()[:10]).custom.where(
    cell_type=&quot;L1&quot;, radius=6, intensity=1
).custom.plot_traces(x='time', plot_kwargs=dict(color='orange', linewidth=0.5))
ax = plt.gca()
centered.sel(network_id=ensemble.argsort()[:10]).custom.where(
    cell_type=&quot;L1&quot;, radius=6, intensity=0
).custom.plot_traces(x='time', plot_kwargs=dict(ax=ax, color='blue', linewidth=0.5))
ax.set_title(&quot;L1 flash responses&quot;)
</code></pre>
<pre><code>Text(0.5, 1.0, 'L1 flash responses')
</code></pre>
<p><img alt="png" src="../03_flyvision_flash_responses_files/03_flyvision_flash_responses_32_1.png" /></p>
<p>Though the scaling varies, all networks predict depolarization to OFF-flashes for L1.</p>
<h3 id="flash-response-index-fri_1">Flash response index (FRI)</h3>
<p>We can also compute flash response indices for each network in the ensemble.</p>
<pre><code># get FRI for L1 cell

fri_l1 = (
    flash_response_index(stims_and_resps, radius=6)
    .sel(network_id=ensemble.argsort()[:10])
    .custom.where(cell_type=&quot;L1&quot;)
)
print(fri_l1.squeeze().values)
</code></pre>
<pre><code>[-0.33354017 -0.28763247 -0.3258682  -0.20794408 -0.33343363 -0.32148352
 -0.13273893 -0.35656792 -0.2945736  -0.33286038]
</code></pre>
<p>All models recover similar flash response indices for this cell type. We can also plot the distribution of FRIs per cell type across the ensemble.</p>
<pre><code>with ensemble.select_items(ensemble.argsort()[:10]):
    ensemble.flash_response_index()
</code></pre>
<pre><code>Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]



Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]



Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]



Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]



Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]



Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]



Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]



Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]



Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]



Batch:   0%|          | 0/1 [00:00&lt;?, ?it/s]
</code></pre>
<p><img alt="png" src="../03_flyvision_flash_responses_files/03_flyvision_flash_responses_37_10.png" /></p>
<h3 id="fri-correlation_1">FRI correlation</h3>
<p>Lastly, we look at the correlations to ground-truth tuning across the ensemble.</p>
<pre><code>from flyvision.analysis.flash_responses import flash_response_index
</code></pre>
<pre><code>fris = flash_response_index(stims_and_resps, radius=6)
</code></pre>
<pre><code>from flyvision.analysis.visualization.plots import violin_groups

# compute correlation
fri_corr = fri_correlation_to_known(fris)

fig, ax, *_ = violin_groups(
    np.array(fri_corr)[None, None, :].squeeze(-1),
    ylabel=&quot;FRI correlation&quot;,
    figsize=(2, 2),
    xlim=(0, 1),
    xticklabels=[],
    colors=[plt.get_cmap(&quot;Pastel1&quot;)(0.0)],
    scatter_edge_color=&quot;gray&quot;,
    scatter_radius=10,
)
</code></pre>
<p><img alt="png" src="../03_flyvision_flash_responses_files/03_flyvision_flash_responses_41_0.png" /></p>
<p>Models in general have very good match to known single-neuron tuning properties, with median correlation around 0.8.</p>













              </article>
            </div>


<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>

      </main>

        <footer class="md-footer">

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">


    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>

</div>

    </div>
  </div>
</footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>


    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>


      <script src="../../assets/javascripts/bundle.d6f25eb3.min.js"></script>

        <script src="../../javascripts/switch-logo.js"></script>


  </body>
</html>
