
<!doctype html>
<html lang="en" class="no-js">
  <head>

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">



        <link rel="canonical" href="https://flyvis.github.io/examples/04_flyvision_moving_edge_responses/">


        <link rel="prev" href="../03_flyvision_flash_responses/">


        <link rel="next" href="../05_flyvision_umap_and_clustering_models/">


      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">



        <title>Moving edge responses - Flyvis</title>



      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">


        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">












        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>



      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">

    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>






  </head>







    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">


    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">


        <a href="#moving-edge-responses" class="md-skip">
          Skip to content
        </a>

    </div>
    <div data-md-component="announce">

    </div>






<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Flyvis" class="md-header__button md-logo" aria-label="Flyvis" data-md-component="logo">

  <img src="../../images/logo_hexagon.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">

      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Flyvis
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">

              Moving edge responses

          </span>
        </div>
      </div>
    </div>






      <label class="md-header__button md-icon" for="__search">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">

        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>

    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>


  </nav>

</header>

    <div class="md-container" data-md-component="container">






      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">



              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Flyvis" class="md-nav__button md-logo" aria-label="Flyvis" data-md-component="logo">

  <img src="../../images/logo_hexagon.jpg" alt="logo">

    </a>
    Flyvis
  </label>

  <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">


  <span class="md-ellipsis">
    Home
  </span>


      </a>
    </li>









    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">


  <span class="md-ellipsis">
    Installation
  </span>


      </a>
    </li>















    <li class="md-nav__item md-nav__item--active md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>


          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">


  <span class="md-ellipsis">
    Tutorials
  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../01_flyvision_connectome/" class="md-nav__link">


  <span class="md-ellipsis">
    Explore the connectome
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../02_flyvision_optic_flow_task/" class="md-nav__link">


  <span class="md-ellipsis">
    Train the network
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../03_flyvision_flash_responses/" class="md-nav__link">


  <span class="md-ellipsis">
    Flash responses
  </span>


      </a>
    </li>












    <li class="md-nav__item md-nav__item--active">

      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">





        <label class="md-nav__link md-nav__link--active" for="__toc">


  <span class="md-ellipsis">
    Moving edge responses
  </span>


          <span class="md-nav__icon md-icon"></span>
        </label>

      <a href="./" class="md-nav__link md-nav__link--active">


  <span class="md-ellipsis">
    Moving edge responses
  </span>


      </a>



<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#moving-edge-stimuli" class="md-nav__link">
    <span class="md-ellipsis">
      Moving edge stimuli
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#moving-edge-response" class="md-nav__link">
    <span class="md-ellipsis">
      Moving edge response
    </span>
  </a>

    <nav class="md-nav" aria-label="Moving edge response">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#response-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Response traces
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#direction-selectivity-index-dsi" class="md-nav__link">
    <span class="md-ellipsis">
      Direction selectivity index (DSI)
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#dsi-and-tuning-curve-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      DSI and tuning curve correlation
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#ensemble-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Ensemble responses
    </span>
  </a>

    <nav class="md-nav" aria-label="Ensemble responses">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#response-traces_1" class="md-nav__link">
    <span class="md-ellipsis">
      Response traces
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#direction-selectivity-index-dsi_1" class="md-nav__link">
    <span class="md-ellipsis">
      Direction selectivity index (DSI)
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#dsi-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      DSI correlation
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>

    </li>










    <li class="md-nav__item">
      <a href="../05_flyvision_umap_and_clustering_models/" class="md-nav__link">


  <span class="md-ellipsis">
    Ensemble clustering
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../06_flyvision_maximally_excitatory_stimuli/" class="md-nav__link">


  <span class="md-ellipsis">
    Maximally excitatory stimuli
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../07_flyvision_providing_custom_stimuli/" class="md-nav__link">


  <span class="md-ellipsis">
    Custom stimuli
  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>









    <li class="md-nav__item">
      <a href="../../contribute/" class="md-nav__link">


  <span class="md-ellipsis">
    Contributing
  </span>


      </a>
    </li>













    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >


          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">


  <span class="md-ellipsis">
    API Reference
  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../../reference/connectome/" class="md-nav__link">


  <span class="md-ellipsis">
    Connectome
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/network/" class="md-nav__link">


  <span class="md-ellipsis">
    Network
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/sintel/" class="md-nav__link">


  <span class="md-ellipsis">
    Sintel
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/tasks/" class="md-nav__link">


  <span class="md-ellipsis">
    Task
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/solver/" class="md-nav__link">


  <span class="md-ellipsis">
    Task Training
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/flash_responses/" class="md-nav__link">


  <span class="md-ellipsis">
    Flash Responses
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/moving_stimulus_responses/" class="md-nav__link">


  <span class="md-ellipsis">
    Moving Stimulus Responses
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/ensemble_clustering/" class="md-nav__link">


  <span class="md-ellipsis">
    Ensemble Clustering
  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../reference/optimal_stimuli/" class="md-nav__link">


  <span class="md-ellipsis">
    Optimal Stimuli
  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>









    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">


  <span class="md-ellipsis">
    FAQ
  </span>


      </a>
    </li>









    <li class="md-nav__item">
      <a href="../../acknowledgements/" class="md-nav__link">


  <span class="md-ellipsis">
    Acknowledgements
  </span>


      </a>
    </li>



  </ul>
</nav>
                  </div>
                </div>
              </div>



              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#moving-edge-stimuli" class="md-nav__link">
    <span class="md-ellipsis">
      Moving edge stimuli
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#moving-edge-response" class="md-nav__link">
    <span class="md-ellipsis">
      Moving edge response
    </span>
  </a>

    <nav class="md-nav" aria-label="Moving edge response">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#response-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Response traces
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#direction-selectivity-index-dsi" class="md-nav__link">
    <span class="md-ellipsis">
      Direction selectivity index (DSI)
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#dsi-and-tuning-curve-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      DSI and tuning curve correlation
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#ensemble-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Ensemble responses
    </span>
  </a>

    <nav class="md-nav" aria-label="Ensemble responses">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#response-traces_1" class="md-nav__link">
    <span class="md-ellipsis">
      Response traces
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#direction-selectivity-index-dsi_1" class="md-nav__link">
    <span class="md-ellipsis">
      Direction selectivity index (DSI)
    </span>
  </a>

</li>

          <li class="md-nav__item">
  <a href="#dsi-correlation" class="md-nav__link">
    <span class="md-ellipsis">
      DSI correlation
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

    </ul>

</nav>
                  </div>
                </div>
              </div>



            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">




<div class="highlight"><pre><span></span><code><span class="o">%</span><span class="n">load_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
</code></pre></div>
<h1 id="moving-edge-responses">Moving edge responses<a class="headerlink" href="#moving-edge-responses" title="Permanent link">&para;</a></h1>
<p>This notebook introduces moving edge responses and the direction selectivity index (DSI). The DSI measures motion selectivity of cells to visual input.</p>
<p><strong>Select GPU runtime</strong></p>
<p>To run the notebook on a GPU select Menu -&gt; Runtime -&gt; Change runtime type -&gt; GPU.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># @markdown **Check access to GPU**</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">google.colab</span>

    <span class="n">IN_COLAB</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">IN_COLAB</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">if</span> <span class="n">IN_COLAB</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">torch</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cuda_name</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">get_device_name</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Name of the assigned GPU / CUDA device: </span><span class="si">{</span><span class="n">cuda_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">warnings</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;You have not selected Runtime Type: &#39;GPU&#39; or Google could not assign you one. Please revisit the settings as described above or proceed on CPU (slow).&quot;</span>
        <span class="p">)</span>
</code></pre></div>
<p><strong>Install Flyvis</strong></p>
<p>The notebook requires installing our package <code>flyvis</code>. You may need to restart your session after running the code block below with Menu -&gt; Runtime -&gt; Restart session. Then, imports from <code>flyvis</code> should succeed without issue.</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="n">IN_COLAB</span><span class="p">:</span>
    <span class="c1">#@markdown **Install Flyvis**</span>
    <span class="o">%%</span><span class="n">capture</span>
    <span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">flyvis</span><span class="o">/</span><span class="n">flyvis</span><span class="o">-</span><span class="n">dev</span><span class="o">.</span><span class="n">git</span>
    <span class="o">%</span><span class="n">cd</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">flyvis</span><span class="o">-</span><span class="n">dev</span>
    <span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># basic imports</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
</code></pre></div>
<h2 id="moving-edge-stimuli">Moving edge stimuli<a class="headerlink" href="#moving-edge-stimuli" title="Permanent link">&para;</a></h2>
<p>To elicit moving edge responses and characterise the motion selectivity of neurons, experimenters show an ON or OFF edge moving in different cardinal directions. We generate and render these stimuli with the <code>MovingEdge</code> dataset.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># import dataset and visualization helper</span>
<span class="kn">from</span> <span class="nn">flyvision.datasets.moving_bar</span> <span class="kn">import</span> <span class="n">MovingEdge</span>
<span class="kn">from</span> <span class="nn">flyvision.animations.hexscatter</span> <span class="kn">import</span> <span class="n">HexScatter</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># initialize dataset</span>
<span class="c1"># make the dataset</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">MovingEdge</span><span class="p">(</span>
    <span class="n">offsets</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span>  <span class="c1"># offset of bar from center in 1 * radians(2.25) led size</span>
    <span class="n">intensities</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># intensity of bar</span>
    <span class="n">speeds</span><span class="o">=</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span>  <span class="c1"># speed of bar in 1 * radians(5.8) / s</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="c1"># height of moving bar in 1 * radians(2.25) led size</span>
    <span class="n">post_pad_mode</span><span class="o">=</span><span class="s2">&quot;continue&quot;</span><span class="p">,</span>  <span class="c1"># for post-stimulus period, continue with the last frame of the stimulus</span>
    <span class="n">t_pre</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># duration of pre-stimulus period</span>
    <span class="n">t_post</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># duration of post-stimulus period</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">200</span><span class="p">,</span>  <span class="c1"># temporal resolution of rendered video</span>
    <span class="n">angles</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">)),</span>  <span class="c1"># motion direction (orthogonal to edge)</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># view stimulus parameters</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">arg_df</span>
<span class="c1"># the dataset has four samples, one corresponding to each row</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>angle</th>
      <th>width</th>
      <th>intensity</th>
      <th>t_stim</th>
      <th>speed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>4</th>
      <td>60</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>5</th>
      <td>60</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>6</th>
      <td>90</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>7</th>
      <td>90</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>8</th>
      <td>120</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>9</th>
      <td>120</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>10</th>
      <td>150</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>11</th>
      <td>150</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>12</th>
      <td>180</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>13</th>
      <td>180</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>14</th>
      <td>210</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>15</th>
      <td>210</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>16</th>
      <td>240</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>17</th>
      <td>240</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>18</th>
      <td>270</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>19</th>
      <td>270</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>20</th>
      <td>300</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>21</th>
      <td>300</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>22</th>
      <td>330</td>
      <td>80</td>
      <td>0</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
    <tr>
      <th>23</th>
      <td>330</td>
      <td>80</td>
      <td>1</td>
      <td>0.428766</td>
      <td>19</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><code><span class="c1"># visualize single sample</span>
<span class="c1"># %#matplotlib notebook</span>
<span class="n">animation</span> <span class="o">=</span> <span class="n">HexScatter</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="kc">None</span><span class="p">,</span> <span class="p">::</span><span class="mi">25</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>  <span class="c1"># intensity=1, radius=6</span>
<span class="n">animation</span><span class="o">.</span><span class="n">animate_in_notebook</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_11_0.png" /></p>
<h2 id="moving-edge-response">Moving edge response<a class="headerlink" href="#moving-edge-response" title="Permanent link">&para;</a></h2>
<p>Now that we have generated the stimulus, we can use it to drive a trained connectome-constrained network.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision</span> <span class="kn">import</span> <span class="n">results_dir</span>
<span class="kn">from</span> <span class="nn">flyvision.network</span> <span class="kn">import</span> <span class="n">NetworkView</span>

<span class="c1"># model are already sorted by task error</span>
<span class="c1"># we take the best task-performing model from the pre-sorted ensemble</span>
<span class="n">network_view</span> <span class="o">=</span> <span class="n">NetworkView</span><span class="p">(</span><span class="n">results_dir</span> <span class="o">/</span> <span class="s2">&quot;flow/0000/000&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-09-25 15:35:49] network:1005 Initialized network view at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">stims_and_resps</span> <span class="o">=</span> <span class="n">network_view</span><span class="o">.</span><span class="n">moving_edge_responses</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-09-25 15:35:49] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/000&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash 3b098d8fe94f37eebf7369247554b311)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:35:49] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000/__cache__/flyvision/analysis/stimulus_responses/compute_responses/3b098d8fe94f37eebf7369247554b311/output.h5


___________________________________compute_responses cache loaded - 0.1s, 0.0min
</code></pre></div>

<p>We&rsquo;ve now computed network moving edge responses for all cells in the network.</p>
<h3 id="response-traces">Response traces<a class="headerlink" href="#response-traces" title="Permanent link">&para;</a></h3>
<p>We can plot single-cell response traces with <code>stims_and_resps['responses'].custom.plot_traces()</code>. Here, we plot responses of T4c cells to edges with intensity 1 (ON edges).</p>
<div class="highlight"><pre><span></span><code><span class="n">stims_and_resps</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="s2">&quot;&gt;-0.5,&lt;1.0&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">legend_labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;angle&quot;</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;T4c responses to moving edge&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Text(0.5, 1.0, &#39;T4c responses to moving edge&#39;)
</code></pre></div>

<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_17_1.png" /></p>
<h3 id="direction-selectivity-index-dsi">Direction selectivity index (DSI)<a class="headerlink" href="#direction-selectivity-index-dsi" title="Permanent link">&para;</a></h3>
<p>The <strong>Direction Selectivity Index (DSI)</strong> quantifies a cell&rsquo;s preference for stimuli moving in a particular direction.</p>
<p>The DSI is derived from the following steps:
1. Obtain the neuron&rsquo;s peak responses to stimuli moving in different directions <span class="arithmatex">\(\theta\)</span> and at different speeds <span class="arithmatex">\(S\)</span>.
2. Rectify these peak responses to ensure they are non-negative.
3. Compute the DSI using the equation:</p>
<div class="arithmatex">\[
DSI_{t_i}(I) = \frac{1}{\lvert S \rvert} \sum_{S \in S} \left\lvert \frac{\sum_{\theta \in \Theta} r^{peak}_{t_{central}}(I, S, \theta) e^{i\theta}}{\max_{I \in I} \left\lvert \sum_{\theta \in \Theta} r^{peak}_{t_{central}}(I, S, \theta) \right\rvert} \right\rvert
\]</div>
<p>Where:
- <span class="arithmatex">\(DSI_{t_i}(I)\)</span> is the Direction Selectivity Index for cell type <span class="arithmatex">\(t_i\)</span> at stimulus intensity <span class="arithmatex">\(I\)</span>.
- <span class="arithmatex">\(\lvert S \rvert\)</span> is the number of different speeds at which stimuli are moved.
- <span class="arithmatex">\(r^{peak}_{t_{central}}(I, S, \theta)\)</span> represents the rectified peak response of the central cell in hexagonal space of a cell type, for a given stimulus intensity <span class="arithmatex">\(I\)</span>, speed <span class="arithmatex">\(S\)</span>, and direction <span class="arithmatex">\(\theta\)</span>.
- <span class="arithmatex">\(\theta\)</span> is varied across all tested directions <span class="arithmatex">\(\Theta\)</span>.
- <span class="arithmatex">\(e^{i\theta}\)</span> introduces the directional component by weighting the response by the complex exponential of the angle of movement.
- The denominator normalizes the responses, ensuring that DSI values range from 0 to 1.</p>
<p>The DSI values range from 0 to 1. A DSI of 0 indicates no directional preference, while a DSI of 1 indicates a strong preference for a specific direction.</p>
<p>For the T4c cell plotted before, we can see that it preferentially responds to ON edges moving at an angle of 60 degrees, so we expect to see a large DSI.</p>
<p>We compute the DSI with <code>flyvision.analysis.direction_selectivity_index</code>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis</span> <span class="kn">import</span> <span class="n">direction_selectivity_index</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># get DSI for T4c cell</span>
<span class="n">dsis</span> <span class="o">=</span> <span class="n">direction_selectivity_index</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T4c DSI: </span><span class="si">{</span><span class="n">dsis</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="s1">&#39;T4c&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>T4c DSI: 0.63
</code></pre></div>

<p>We compute the preferred direction of the cell with <code>flyvision.analysis.preferred_direction</code> (this is the direction that the tuning lobe points towards). We would expect the preferred direction to be around 60 degrees based on the response traces.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis</span> <span class="kn">import</span> <span class="n">preferred_direction</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">pds</span> <span class="o">=</span> <span class="n">preferred_direction</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;T4c preferred direction: </span><span class="si">{</span><span class="n">pds</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="s1">&#39;T4c&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">180</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> degrees&quot;</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>T4c preferred direction: 56.24 degrees
</code></pre></div>

<p>We can also inspect the direction selecity of a cell type visually, by plotting the angular tuning with <code>plot_angular_tuning</code>.</p>
<p>Here we see clearly how the cell is tuned to stimuli moving at a 60 degree angle.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis</span> <span class="kn">import</span> <span class="n">plot_angular_tuning</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">plot_angular_tuning</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">,</span> <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>(&lt;Figure size 300x300 with 1 Axes&gt;, &lt;PolarAxes: &gt;)
</code></pre></div>

<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_27_1.png" /></p>
<h3 id="dsi-and-tuning-curve-correlation">DSI  and tuning curve correlation<a class="headerlink" href="#dsi-and-tuning-curve-correlation" title="Permanent link">&para;</a></h3>
<p>With the <code>dsi()</code> function we can also compute DSIs for every cell type at once. Since the selectivity of some cell types have been determined experimentally, we can then compare our model to experimental findings by computing the correlation between the model DSIs for known cell types with their expected motion selectivity.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis</span> <span class="kn">import</span> <span class="n">dsi_correlation_to_known</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">dsi_corr</span> <span class="o">=</span> <span class="n">dsi_correlation_to_known</span><span class="p">(</span>
    <span class="n">direction_selectivity_index</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DSI correlation = </span><span class="si">{</span><span class="n">dsi_corr</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2"> .2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>DSI correlation =  0.65
</code></pre></div>

<p>Further, for certain cell types, their actual tuning curves have also been measured experimentally, so we can correlate our model cell&rsquo;s tuning to the true values. For T4c, the cell is known to tune to stimuli moving at 90 degrees, so the correlation should be relatively high.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis</span> <span class="kn">import</span> <span class="n">correlation_to_known_tuning_curves</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">corrs</span> <span class="o">=</span> <span class="n">correlation_to_known_tuning_curves</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;T4c tuning curve correlation = </span><span class="si">{</span><span class="n">corrs</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="s1">&#39;T4c&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>T4c tuning curve correlation = 0.54
</code></pre></div>

<p>In fact, tuning curves for all T4 and T5 cells have been measured, so we can compute the correlation for all 8 cell types.</p>
<div class="highlight"><pre><span></span><code><span class="n">t4_corrs</span> <span class="o">=</span> <span class="n">corrs</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t5_corrs</span> <span class="o">=</span> <span class="n">corrs</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;T4 tuning curve correlations: </span><span class="si">{</span><span class="n">t4_corrs</span><span class="o">.</span><span class="n">cell_type</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">t4_corrs</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>T4 tuning curve correlations: [&#39;T4a&#39; &#39;T4b&#39; &#39;T4c&#39; &#39;T4d&#39;]
[0.93699976 0.71944943 0.53721794 0.85661069]
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;T5 tuning curve correlations: </span><span class="si">{</span><span class="n">t5_corrs</span><span class="o">.</span><span class="n">cell_type</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">t5_corrs</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>T5 tuning curve correlations: [&#39;T5a&#39; &#39;T5b&#39; &#39;T5c&#39; &#39;T5d&#39;]
[0.84125435 0.90320946 0.94956466 0.90100504]
</code></pre></div>

<p>So, the model yields accurate predictions for all T4 and T5 cell types.</p>
<h2 id="ensemble-responses">Ensemble responses<a class="headerlink" href="#ensemble-responses" title="Permanent link">&para;</a></h2>
<p>Now we can compare motion selectivity properties across an ensemble of trained models. First we need to again simulate the network responses.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision</span> <span class="kn">import</span> <span class="n">EnsembleView</span>

<span class="n">ensemble</span> <span class="o">=</span> <span class="n">EnsembleView</span><span class="p">(</span><span class="n">results_dir</span> <span class="o">/</span> <span class="s2">&quot;flow/0000&quot;</span><span class="p">)</span>
<span class="c1"># choose best 10</span>
<span class="n">ensemble</span> <span class="o">=</span> <span class="n">ensemble</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]]</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Loading ensemble:   0%|          | 0/50 [00:00&lt;?, ?it/s]


[2024-09-25 15:36:10] ensemble:138 Loaded 50 networks.



Loading ensemble:   0%|          | 0/10 [00:00&lt;?, ?it/s]


[2024-09-25 15:36:15] ensemble:138 Loaded 10 networks.
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">%%</span><span class="n">capture</span>
<span class="n">stims_and_resps</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">moving_edge_responses</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>[2024-09-25 15:36:16] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/000&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash 3b098d8fe94f37eebf7369247554b311)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:36:16] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/000/__cache__/flyvision/analysis/stimulus_responses/compute_responses/3b098d8fe94f37eebf7369247554b311/output.h5
[2024-09-25 15:36:16] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/001/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/001&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/001/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash 325e88a715551d0a149b5dae673c8f83)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/001/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:36:16] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/001/__cache__/flyvision/analysis/stimulus_responses/compute_responses/325e88a715551d0a149b5dae673c8f83/output.h5
[2024-09-25 15:36:16] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/002/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/002&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/002/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash 8912ba93ac77a2d8a372a9aedbce0d4b)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/002/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:36:16] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/002/__cache__/flyvision/analysis/stimulus_responses/compute_responses/8912ba93ac77a2d8a372a9aedbce0d4b/output.h5
[2024-09-25 15:36:16] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/003/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/003&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/003/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash 34abd51c78f6409009acc6ec30fb6e54)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/003/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:36:16] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/003/__cache__/flyvision/analysis/stimulus_responses/compute_responses/34abd51c78f6409009acc6ec30fb6e54/output.h5
[2024-09-25 15:36:16] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/004/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/004&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/004/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash 757735e00ab721a6bcd14c8ac50f65c9)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/004/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:36:16] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/004/__cache__/flyvision/analysis/stimulus_responses/compute_responses/757735e00ab721a6bcd14c8ac50f65c9/output.h5
[2024-09-25 15:36:16] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/005/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/005&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/005/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash 761b503cb11d83b87ccca4437485a05c)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/005/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:36:16] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/005/__cache__/flyvision/analysis/stimulus_responses/compute_responses/761b503cb11d83b87ccca4437485a05c/output.h5
[2024-09-25 15:36:17] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/006/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/006&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/006/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash 2ef227637edf3421104836b79b8dd061)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/006/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:36:17] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/006/__cache__/flyvision/analysis/stimulus_responses/compute_responses/2ef227637edf3421104836b79b8dd061/output.h5
[2024-09-25 15:36:17] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/007/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/007&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/007/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash e2e8db05a1a5046ed0ec8793ea1bf1ec)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/007/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:36:17] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/007/__cache__/flyvision/analysis/stimulus_responses/compute_responses/e2e8db05a1a5046ed0ec8793ea1bf1ec/output.h5
[2024-09-25 15:36:17] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/008/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/008&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/008/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash 93e70ecb95c60d98cdc493ee50ba177b)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/008/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:36:17] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/008/__cache__/flyvision/analysis/stimulus_responses/compute_responses/93e70ecb95c60d98cdc493ee50ba177b/output.h5
[2024-09-25 15:36:17] logger:83 [MemorizedFunc(func=&lt;function compute_responses at 0x7f3082758790&gt;, location=/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/009/__cache__)]:
                        Querying compute_responses with signature
                        compute_responses(CheckpointedNetwork(network_class=&lt;class &#39;flyvision.network.Network&#39;&gt;, config={&#39;connectome&#39;: {&#39;type&#39;: &#39;ConnectomeDir&#39;, &#39;file&#39;: &#39;fib25-fib19_v2.2.json&#39;, &#39;extent&#39;: 15, &#39;n_syn_fill&#39;: 1}, &#39;dynamics&#39;: {&#39;type&#39;: &#39;PPNeuronIGRSynapses&#39;, &#39;activation&#39;: {&#39;type&#39;: &#39;relu&#39;}}, &#39;node_config&#39;: {&#39;bias&#39;: {&#39;type&#39;: &#39;RestingPotential&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Normal&#39;, &#39;mode&#39;: &#39;sample&#39;, &#39;requires_grad&#39;: True, &#39;mean&#39;: 0.5, &#39;std&#39;: 0.05, &#39;penalize&#39;: {&#39;activity&#39;: True}, &#39;seed&#39;: 0}, &#39;time_const&#39;: {&#39;type&#39;: &#39;TimeConstant&#39;, &#39;groupby&#39;: [&#39;type&#39;], &#39;initial_dist&#39;: &#39;Value&#39;, &#39;value&#39;: 0.05, &#39;requires_grad&#39;: True}}, &#39;edge_config&#39;: {&#39;sign&#39;: {&#39;type&#39;: &#39;SynapseSign&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: False, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;]}, &#39;syn_count&#39;: {&#39;type&#39;: &#39;SynapseCount&#39;, &#39;initial_dist&#39;: &#39;Lognormal&#39;, &#39;mode&#39;: &#39;mean&#39;, &#39;requires_grad&#39;: False, &#39;std&#39;: 1.0, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;du&#39;, &#39;dv&#39;]}, &#39;syn_strength&#39;: {&#39;type&#39;: &#39;SynapseCountScaling&#39;, &#39;initial_dist&#39;: &#39;Value&#39;, &#39;requires_grad&#39;: True, &#39;scale_elec&#39;: 0.01, &#39;scale_chem&#39;: 0.01, &#39;clamp&#39;: &#39;non_negative&#39;, &#39;groupby&#39;: [&#39;source_type&#39;, &#39;target_type&#39;, &#39;edge_type&#39;]}}}, name=&#39;flow/0000/009&#39;, checkpoint=PosixPath(&#39;/groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/009/chkpts/chkpt_00000&#39;), recover_fn=&lt;function recover_network at 0x7f30798ac430&gt;, network=None),
&lt;class &#39;flyvision.datasets.moving_bar.MovingEdge&#39;&gt;, { &#39;angles&#39;: [0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330],
  &#39;bar_loc_horizontal&#39;: 0.0,
  &#39;dt&#39;: 0.005,
  &#39;height&#39;: 80,
  &#39;intensities&#39;: [0, 1],
  &#39;offsets&#39;: [-10, 11],
  &#39;post_pad_mode&#39;: &#39;continue&#39;,
  &#39;shuffle_offsets&#39;: False,
  &#39;speeds&#39;: [19],
  &#39;t_post&#39;: 1.0,
  &#39;t_pre&#39;: 1.0,
  &#39;widths&#39;: [80]},
4, 1.0, 0.0).

                        (argument hash bf2f8033eea3ff6c92e1e5f355f18096)

                        The store location is /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/009/__cache__/flyvision/analysis/stimulus_responses/compute_responses.

[2024-09-25 15:36:17] xarray_joblib_backend:582 Loading Dataset from NetCDF at /groups/turaga/home/lappalainenj/FlyVis/private/flyvision/data/results/flow/0000/009/__cache__/flyvision/analysis/stimulus_responses/compute_responses/bf2f8033eea3ff6c92e1e5f355f18096/output.h5
</code></pre></div>

<h3 id="response-traces_1">Response traces<a class="headerlink" href="#response-traces_1" title="Permanent link">&para;</a></h3>
<p>We can once again plot response traces for a single cell type. </p>
<p>We subtract the initial value of each trace and divide by the max as the network neuron activities are in arbitrary units. </p>
<p>We plot only T4c responses to ON edges moving at a 90-degree angle.</p>
<div class="highlight"><pre><span></span><code><span class="n">responses</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">stims_and_resps</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">stims_and_resps</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">responses</span> <span class="o">=</span> <span class="n">responses</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;frame&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">responses</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span>
    <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="s2">&quot;&gt;-0.5,&lt;1.0&quot;</span><span class="p">,</span>
    <span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">plot_traces</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span><span class="p">),</span> <span class="n">legend_labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;network_id&quot;</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>&lt;Axes: xlabel=&#39;time&#39;, ylabel=&#39;responses&#39;&gt;
</code></pre></div>

<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_47_1.png" /></p>
<p>Though for most networks T4c responses are correctly predicted to the stimuli, there are some networks in the ensemble with different responses.</p>
<h3 id="direction-selectivity-index-dsi_1">Direction selectivity index (DSI)<a class="headerlink" href="#direction-selectivity-index-dsi_1" title="Permanent link">&para;</a></h3>
<p>We can also compute direction selectivity indices for each network in the ensemble.</p>
<div class="highlight"><pre><span></span><code><span class="n">dsis</span> <span class="o">=</span> <span class="n">direction_selectivity_index</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">dsis</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;T4c DSI distribution&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of networks&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>Text(0, 0.5, &#39;Number of networks&#39;)
</code></pre></div>

<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_51_1.png" /></p>
<p>Most networks in this group recover some direction selectivity for T4c. We can also plot the distribution of DSIs per cell type for both ON and OFF-edge stimuli across the ensemble.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.analysis.moving_bar_responses</span> <span class="kn">import</span> <span class="n">plot_dsis</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_dsis</span><span class="p">(</span>
    <span class="n">dsis</span><span class="p">,</span>
    <span class="n">dsis</span><span class="o">.</span><span class="n">cell_type</span><span class="p">,</span>
    <span class="n">bold_output_type_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">output_cell_types</span><span class="o">=</span><span class="n">ensemble</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">connectome</span><span class="o">.</span><span class="n">output_cell_types</span><span class="p">[:]</span>
    <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">],</span>
    <span class="n">color_known_types</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
    <span class="n">scatter_best_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">scatter_best_color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Blues&quot;</span><span class="p">)(</span><span class="mf">1.0</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_53_0.png" /></p>
<h3 id="dsi-correlation">DSI correlation<a class="headerlink" href="#dsi-correlation" title="Permanent link">&para;</a></h3>
<p>Lastly, we look at the correlations to ground-truth DSIs and tuning curves across the ensemble. This provides us with a high-level understanding of the accuracy of known motion tuning predictions. </p>
<div class="highlight"><pre><span></span><code><span class="n">dsi_corr</span> <span class="o">=</span> <span class="n">dsi_correlation_to_known</span><span class="p">(</span>
    <span class="n">direction_selectivity_index</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="s2">&quot;intensity&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">tuning_corrs</span> <span class="o">=</span> <span class="n">correlation_to_known_tuning_curves</span><span class="p">(</span><span class="n">stims_and_resps</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">t4_corrs</span> <span class="o">=</span> <span class="n">tuning_corrs</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T4a&quot;</span><span class="p">,</span> <span class="s2">&quot;T4b&quot;</span><span class="p">,</span> <span class="s2">&quot;T4c&quot;</span><span class="p">,</span> <span class="s2">&quot;T4d&quot;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="s2">&quot;neuron&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">t5_corrs</span> <span class="o">=</span> <span class="n">tuning_corrs</span><span class="o">.</span><span class="n">custom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cell_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;T5a&quot;</span><span class="p">,</span> <span class="s2">&quot;T5b&quot;</span><span class="p">,</span> <span class="s2">&quot;T5c&quot;</span><span class="p">,</span> <span class="s2">&quot;T5d&quot;</span><span class="p">],</span> <span class="n">intensity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="s2">&quot;neuron&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">dsi_corr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">t4_corrs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">t5_corrs</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>((10,), (10,), (10,))
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flyvision.plots.plots</span> <span class="kn">import</span> <span class="n">violin_groups</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">violin_groups</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">dsi_corr</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">t4_corrs</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">t5_corrs</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:],</span>
    <span class="p">[</span><span class="s2">&quot;DSI&quot;</span><span class="p">,</span> <span class="s2">&quot;T4 tuning&quot;</span><span class="p">,</span> <span class="s2">&quot;T5 tuning&quot;</span><span class="p">],</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;correlation&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">1.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">colors</span><span class="o">=</span><span class="p">[</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Dark2&quot;</span><span class="p">)(</span><span class="mf">0.125</span><span class="p">),</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Dark2&quot;</span><span class="p">)(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Dark2&quot;</span><span class="p">)(</span><span class="mf">0.25</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">color_by</span><span class="o">=</span><span class="s2">&quot;experiments&quot;</span><span class="p">,</span>
    <span class="n">scatter_edge_color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
    <span class="n">scatter_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">violin_alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../04_flyvision_moving_edge_responses_files/04_flyvision_moving_edge_responses_59_0.png" /></p>
<!-- ... Models in general have very good match to known single-neuron tuning properties, with median correlation around $0.8$. -->













              </article>
            </div>


<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>

      </main>

        <footer class="md-footer">

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">


    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>

</div>

    </div>
  </div>
</footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>


    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>


      <script src="../../assets/javascripts/bundle.d6f25eb3.min.js"></script>


  </body>
</html>
